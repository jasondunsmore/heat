<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Heat Orchestration Template (HOT) Specification &mdash; Supported Resources</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2015.2.dev78',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Supported Resources" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../raxdox/index.html">Supported Resources</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="heat-orchestration-template-hot-specification">
<span id="hot-spec"></span><h1>Heat Orchestration Template (HOT) Specification<a class="headerlink" href="#heat-orchestration-template-hot-specification" title="Permalink to this headline">¶</a></h1>
<p>HOT is a new template format meant to replace the Heat CloudFormation-compatible
format (CFN) as the native format supported by the Heat over time.
This specification explains in detail all elements of the HOT template format.
An example driven guide to writing HOT templates can be found
at <a class="reference internal" href="hot_guide.html#hot-guide"><em>Heat Orchestration Template (HOT) Guide</em></a>.</p>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p>HOT is considered reliable, supported, and standardized as of our
Icehouse (April 2014) release.  The Heat core team may make improvements
to the standard, which very likely would be backward compatible.  The template
format is also versioned.  Since Juno release, Heat supports multiple
different versions of the HOT specification.</p>
</div>
<div class="section" id="template-structure">
<h2>Template Structure<a class="headerlink" href="#template-structure" title="Permalink to this headline">¶</a></h2>
<p>HOT templates are defined in YAML and follow the structure outlined below.</p>
<div class="highlight-python"><div class="highlight"><pre>heat_template_version: 2013-05-23

description:
  # a description of the template

parameter_groups:
  # a declaration of input parameter groups and order

parameters:
  # declaration of input parameters

resources:
  # declaration of template resources

outputs:
  # declaration of output parameters
</pre></div>
</div>
<dl class="docutils">
<dt>heat_template_version</dt>
<dd>This key with value <em>2013-05-23</em> (or a later date) indicates that the YAML
document is a HOT template of the specified version.</dd>
<dt>description</dt>
<dd>This <em>optional</em> key allows for giving a description of the template, or the
workload that can be deployed using the template.</dd>
<dt>parameter_groups</dt>
<dd>This section allows for specifying how the input parameters should be
grouped and the order to provide the parameters in. This section is
<em>optional</em> and can be omitted when necessary.</dd>
<dt>parameters</dt>
<dd>This section allows for specifying input parameters that have to be provided
when instantiating the template. The section is <em>optional</em> and can be
omitted when no input is required.</dd>
<dt>resources</dt>
<dd>This section contains the declaration of the single resources of the
template. This section with at least one resource should be defined in any
HOT template, or the template would not really do anything when being
instantiated.</dd>
<dt>outputs</dt>
<dd>This section allows for specifying output parameters available to users once
the template has been instantiated. This section is <em>optional</em> and can be
omitted when no output values are required.</dd>
</dl>
</div>
<div class="section" id="heat-template-version">
<span id="hot-spec-template-version"></span><h2>Heat Template Version<a class="headerlink" href="#heat-template-version" title="Permalink to this headline">¶</a></h2>
<p>The value of  <em>heat_template_version</em> tells Heat not only the format of the
template but also features that will be validated and supported.
For example, Heat currently supports the following values for the
<em>heat_template_version</em> key:</p>
<dl class="docutils">
<dt>2013-05-23</dt>
<dd>The key with value <em>2013-05-23</em> indicates that the YAML document is a HOT
template and it may contain features implemented until the Icehouse release.
This version supports the following functions (some are back ported
to this version):</dd>
</dl>
<dl class="docutils">
<dt>::</dt>
<dd>get_attr
get_file
get_param
get_resource
list_join
resource_facade
str_replace
Fn::Base64
Fn::GetAZs
Fn::Join
Fn::MemberListToMap
Fn::Replace
Fn::ResourceFacade
Fn::Select
Fn::Split
Ref</dd>
<dt>2014-10-16</dt>
<dd>The key with value <em>2014-10-16</em> indicates that the YAML document is a HOT
template and it may contain features added and/or removed up until the Juno
release.  This version removes most CFN functions that were supported in
the Icehouse release, i.e. the <em>2013-05-23</em> version.  So the supported functions
now are:</dd>
</dl>
<dl class="docutils">
<dt>::</dt>
<dd>get_attr
get_file
get_param
get_resource
list_join
resource_facade
str_replace
Fn::Select</dd>
<dt>2015-04-30</dt>
<dd>The key with value <em>2015-04-30</em> indicates that the YAML document is a HOT
template and it may contain features added and/or removed up until the Kilo
release. This version adds the <em>repeat</em> function. So the complete list of
supported functions is:</dd>
</dl>
<dl class="docutils">
<dt>::</dt>
<dd>get_attr
get_file
get_param
get_resource
list_join
repeat
digest
resource_facade
str_replace
Fn::Select</dd>
</dl>
</div>
<div class="section" id="parameter-groups-section">
<span id="hot-spec-parameter-groups"></span><h2>Parameter Groups Section<a class="headerlink" href="#parameter-groups-section" title="Permalink to this headline">¶</a></h2>
<p>The <em>parameter_groups</em> section allows for specifying how the input parameters
should be grouped and the order to provide the parameters in. These groups are
typically used to describe expected behavior for downstream user interfaces.</p>
<p>These groups are specified in a list with each group containing a list of
associated parameters. The lists are used to denote the expected order of the
parameters. Each parameter should be associated to a specific group only once
using the parameter name to bind it to a defined parameter in the parameters
section.</p>
<div class="highlight-python"><div class="highlight"><pre>parameter_groups:
- label: &lt;human-readable label of parameter group&gt;
  description: &lt;description of the parameter group&gt;
  parameters:
  - &lt;param name&gt;
  - &lt;param name&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>label</dt>
<dd>A human-readable label that defines the associated group of parameters.</dd>
<dt>description</dt>
<dd>This attribute allows for giving a human-readable description of the
parameter group.</dd>
<dt>parameters</dt>
<dd>A list of parameters associated with this parameter group.</dd>
<dt>param name</dt>
<dd>The name of the parameter that is defined in the associated parameters
section.</dd>
</dl>
</div>
<div class="section" id="parameters-section">
<span id="hot-spec-parameters"></span><h2>Parameters Section<a class="headerlink" href="#parameters-section" title="Permalink to this headline">¶</a></h2>
<p>The <em>parameters</em> section allows for specifying input parameters that have to be
provided when instantiating the template. Such parameters are typically used to
customize each deployment (e.g. by setting custom user names or passwords) or
for binding to environment-specifics like certain images.</p>
<p>Each parameter is specified in a separated nested block with the name of the
parameters defined in the first line and additional attributes such as type or
default value defined as nested elements.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  &lt;param name&gt;:
    type: &lt;string | number | json | comma_delimited_list | boolean&gt;
    label: &lt;human-readable name of the parameter&gt;
    description: &lt;description of the parameter&gt;
    default: &lt;default value for parameter&gt;
    hidden: &lt;true | false&gt;
    constraints:
      &lt;parameter constraints&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>param name</dt>
<dd>The name of the parameter is defined at the top of each parameter block.</dd>
<dt>type</dt>
<dd>This attribute specifies the type of parameter. Currently supported types
are <em>string</em>, <em>number</em>, <em>comma_delimited_list</em>, <em>json</em>, or <em>boolean</em>.</dd>
<dt>label</dt>
<dd>This <em>optional</em> attribute allows for giving a human readable name of the
parameter.</dd>
<dt>description</dt>
<dd>This <em>optional</em> attribute allows for giving a human readable description of
the parameter.</dd>
<dt>default</dt>
<dd>This <em>optional</em> attribute allows for defining a default value for the
parameters which will be used in case the parameter is not specified by the
user during deployment.</dd>
<dt>hidden</dt>
<dd>This <em>optional</em> attribute allows for specifying whether the parameters
should be hidden when showing information about a stack created from the
template at runtime (e.g. for hiding passwords that were specified as
parameters). If not specified, the default value &#8216;false&#8217; will be used.</dd>
<dt>constraints</dt>
<dd>This <em>optional</em> block allows for specifying additional constraints on the
parameter, such as minimum or maximum values for numeric parameters.</dd>
</dl>
<p>The following example shows a minimalistic definition of two parameters. Note
that the description and label are actually optional, but is good practice to
provide a useful description and label for each parameter.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  user_name:
    type: string
    label: User Name
    description: User name to be configured for the application
  port_number:
    type: number
    label: Port Number
    description: Port number to be configured for the web server
</pre></div>
</div>
<div class="section" id="parameter-constraints">
<span id="hot-spec-parameters-constraints"></span><h3>Parameter Constraints<a class="headerlink" href="#parameter-constraints" title="Permalink to this headline">¶</a></h3>
<p>The <em>constraints</em> block of a parameter definition allows for defining additional
validation constraints that apply to the value of the parameter. At
instantiation time of the template, user provided parameter values are validated
against those constraints to make sure the provided values match expectations of
the template author.
Constraints are defined in the form of a bulleted list according to the
following syntax:</p>
<div class="highlight-python"><div class="highlight"><pre>constraints:
  - &lt;constraint type&gt;: &lt;constraint definition&gt;
    description: &lt;constraint description&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>constraint type</dt>
<dd>The constraint type specifies the kind of constraint defined in the current
bulleted list item. The set of currently supported constraints is given
below.</dd>
<dt>constraint definition</dt>
<dd>This value defines the actual constraint, depending on the constraint type.
The concrete syntax for each constraint type is given below.</dd>
<dt>description</dt>
<dd>This <em>optional</em> attribute allows for specifying a concrete description of
the current constraint. This text will be presented to the user, for
example, when the provided input value for a parameter violates the
constraint. If omitted, a default validation message will be presented to
the user.</dd>
</dl>
<p>The following example show the definition of a string parameter with two
constraints. Note that while the descriptions for each constraint are optional,
it is good practice to provide concrete descriptions so useful messages can be
presented to the user at deployment time.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  user_name:
    type: string
    label: User Name
    description: User name to be configured for the application
    constraints:
      - length: { min: 6, max: 8 }
        description: User name must be between 6 and 8 characters
      - allowed_pattern: &quot;[A-Z]+[a-zA-Z0-9]*&quot;
        description: User name must start with an uppercase character
</pre></div>
</div>
<p>The following sections list the supported types of parameter constraints, along
with the concrete syntax for each type.</p>
<div class="section" id="length">
<h4>length<a class="headerlink" href="#length" title="Permalink to this headline">¶</a></h4>
<p>The <em>length</em> constraint applies to parameters of type <em>string</em> and allows for
defining a lower and upper limit for the length of the string value. The syntax
for the length constraint is:</p>
<div class="highlight-python"><div class="highlight"><pre>length: { min: &lt;lower limit&gt;, max: &lt;upper limit&gt; }
</pre></div>
</div>
<p>It is possible to define a length constraint with only a lower limit or an
upper limit. However, at least one of <em>min</em> or <em>max</em> must be specified.</p>
</div>
<div class="section" id="range">
<h4>range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h4>
<p>The <em>range</em> constraint applies to parameters of type <em>number</em> and allows for
defining a lower and upper limit for the numeric value of the parameter. The
syntax of the range constraint is:</p>
<div class="highlight-python"><div class="highlight"><pre>range: { min: &lt;lower limit&gt;, max: &lt;upper limit&gt; }
</pre></div>
</div>
<p>It is possible to define a range constraint with only a lower limit or an
upper limit. However, at least one of <em>min</em> or <em>max</em> must be specified.
The minimum or maximum boundaries are included in the range. For example, the
following range constraint would allow for all numeric values between 0 and 10.</p>
<div class="highlight-python"><div class="highlight"><pre>range: { min: 0, max: 10 }
</pre></div>
</div>
</div>
<div class="section" id="allowed-values">
<h4>allowed_values<a class="headerlink" href="#allowed-values" title="Permalink to this headline">¶</a></h4>
<p>The <em>allowed_values</em> constraint applies to parameters of type string or number
and allows for specifying a set of possible values for a parameter. At
deployment time, the user provided value for the respective parameter must
match one of the elements of the specified list. The syntax of the
allowed_values constraint is:</p>
<div class="highlight-python"><div class="highlight"><pre>allowed_values: [ &lt;value&gt;, &lt;value&gt;, ... ]
</pre></div>
</div>
<p>Alternatively, the YAML bulleted list notation can be used:</p>
<div class="highlight-python"><div class="highlight"><pre>allowed_values:
  - &lt;value&gt;
  - &lt;value&gt;
  - ...
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  instance_type:
    type: string
    label: Instance Type
    description: Instance type for compute instances
    constraints:
      - allowed_values:
        - m1.small
        - m1.medium
        - m1.large
</pre></div>
</div>
</div>
<div class="section" id="allowed-pattern">
<h4>allowed_pattern<a class="headerlink" href="#allowed-pattern" title="Permalink to this headline">¶</a></h4>
<p>The <em>allowed_pattern</em> constraint applies to parameters of type string and allows
for specifying a regular expression against which a user provided parameter
value must evaluate at deployment.
The syntax of the allowed_pattern constraint is:</p>
<div class="highlight-python"><div class="highlight"><pre>allowed_pattern: &lt;regular expression&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  user_name:
    type: string
    label: User Name
    description: User name to be configured for the application
    constraints:
      - allowed_pattern: &quot;[A-Z]+[a-zA-Z0-9]*&quot;
        description: User name must start with an uppercase character
</pre></div>
</div>
</div>
<div class="section" id="custom-constraint">
<h4>custom_constraint<a class="headerlink" href="#custom-constraint" title="Permalink to this headline">¶</a></h4>
<p>The <em>custom_constraint</em> constraint adds an extra step of validation, generally
to check that the specified resource exists in the backend. Custom constraints
get implemented by plug-ins and can provide any kind of advanced constraint
validation logic.</p>
<p>The syntax of the custom_constraint constraint is:</p>
<div class="highlight-python"><div class="highlight"><pre>custom_constraint: &lt;name&gt;
</pre></div>
</div>
<p>The <em>name</em> specifies the concrete type of custom constraint. It corresponds to
the name under which the respective validation plugin has been registered with
the Heat engine.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  key_name
    type: string
    description: SSH key pair
    constraints:
      - custom_constraint: nova.keypair
</pre></div>
</div>
</div>
</div>
<div class="section" id="pseudo-parameters">
<span id="hot-spec-pseudo-parameters"></span><h3>Pseudo Parameters<a class="headerlink" href="#pseudo-parameters" title="Permalink to this headline">¶</a></h3>
<p>In addition to parameters defined by a template author, Heat also
creates three parameters for every stack that allow referential access
to the stack&#8217;s name, stack&#8217;s identifier and project&#8217;s
identifier. These parameters are named <tt class="docutils literal"><span class="pre">OS::stack_name</span></tt> for the
stack name, <tt class="docutils literal"><span class="pre">OS::stack_id</span></tt> for the stack identifier and
<tt class="docutils literal"><span class="pre">OS::project_id</span></tt> for the project identifier. These values are
accessible via the <a class="reference internal" href="#get-param">get_param</a> intrinsic function just like
user-defined parameters.</p>
</div>
</div>
<div class="section" id="resources-section">
<span id="hot-spec-resources"></span><h2>Resources Section<a class="headerlink" href="#resources-section" title="Permalink to this headline">¶</a></h2>
<p>In the <em>resources</em> section, the templates for actual resources that will make up
a stack deployed from the HOT template (e.g. compute instances, networks,
storage volumes) are defined.
Each resource is defined as a separate block in the resources section according
to the syntax below.</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  &lt;resource ID&gt;:
    type: &lt;resource type&gt;
    properties:
      &lt;property name&gt;: &lt;property value&gt;
    metadata:
      &lt;resource specific metadata&gt;
    depends_on: &lt;resource ID or list of ID&gt;
    update_policy: &lt;update policy&gt;
    deletion_policy: &lt;deletion policy&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>resource ID</dt>
<dd>A resource block is headed by the resource ID, which must be unique within
the resource section of a template.</dd>
<dt>type</dt>
<dd>This attribute specifies the type of resource, such as OS::Nova::Server.</dd>
<dt>properties</dt>
<dd>This <em>optional</em> section contains a list of resource specific properties.
The property value can be provided in place, or can be provided via a
function (see <a class="reference internal" href="#hot-spec-intrinsic-functions"><em>Intrinsic Functions</em></a>).</dd>
<dt>metadata</dt>
<dd>This <em>optional</em> section contains resource type specific metadata.</dd>
<dt>depends_on</dt>
<dd>This <em>optional</em> attribute allows for specifying dependencies of the current
resource on one or more other resources. Please refer to section
<a class="reference internal" href="#hot-spec-resources-dependencies"><em>Resource Dependencies</em></a> for details.</dd>
<dt>update_policy:</dt>
<dd>This <em>optional</em> attribute allows for specifying an update policy for the
resource in the form of a nested dictionary (name-value pairs). Whether
update policies are supported and what the exact semantics are depends on
the type of the current resource.</dd>
<dt>deletion_policy:</dt>
<dd>This <em>optional</em> attribute allows for specifying a deletion policy for the
resource (one of the values Delete, Retain or Snapshot). Which type of
deletion policy is supported depends on the type of the current resource.</dd>
</dl>
<p>Depending on the type of resource, the resource block might include more
resource specific data. Basically all resource types that can be used in
CFN templates can also be used in HOT templates, adapted to the YAML structure
as outlined above.
Below is an example of a simple compute resource definition with some fixed
property values.</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      flavor: m1.small
      image: F18-x86_64-cfntools
</pre></div>
</div>
<div class="section" id="resource-dependencies">
<span id="hot-spec-resources-dependencies"></span><h3>Resource Dependencies<a class="headerlink" href="#resource-dependencies" title="Permalink to this headline">¶</a></h3>
<p>By means of the <em>depends_on</em> attribute within a resource section it is possible
to define a dependency between a resource and one or more other resources. If
a resource depends on just one other resource, the ID of the other resource is
specified as value of the <em>depends_on</em> attribute as shown in the following
example.</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  server1:
    type: OS::Nova::Server
    depends_on: server2

  server2:
    type: OS::Nova::Server
</pre></div>
</div>
<p>If a resource depends on more than one other resource, the value of the
<em>depends_on</em> attribute is specified as a list of resource IDs as shown in the
following example:</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  server1:
    type: OS::Nova::Server
    depends_on: [ server2, server3 ]

  server2:
    type: OS::Nova::Server

  server3:
    type: OS::Nova::Server
</pre></div>
</div>
</div>
</div>
<div class="section" id="outputs-section">
<span id="hot-spec-outputs"></span><h2>Outputs Section<a class="headerlink" href="#outputs-section" title="Permalink to this headline">¶</a></h2>
<p>In the <em>outputs</em> section, any output parameters that should be available to the
user can be defined. Typically, this would be, for example, parameters such as
IP addresses of deployed instances, or URLs of web applications deployed as part
of a stack.</p>
<p>Each output parameter is defined as a separate block within the outputs section
according to the following syntax:</p>
<div class="highlight-python"><div class="highlight"><pre>outputs:
  &lt;parameter name&gt;:
    description: &lt;description&gt;
    value: &lt;parameter value&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>parameter name</dt>
<dd>An output parameter block is headed by the output parameter name, which must
be unique within the outputs section of a template.</dd>
<dt>description</dt>
<dd>This element gives a short description of the output parameter.</dd>
<dt>parameter value</dt>
<dd>This element specifies the value of the output parameter. Typically, this
will be resolved by means of a function, e.g. by getting an attribute value
of one of the stack&#8217;s resources (see also
<a class="reference internal" href="#hot-spec-intrinsic-functions"><em>Intrinsic Functions</em></a>).</dd>
</dl>
<p>The example below shows, how the IP address of a compute resource can be defined
as an output parameter.</p>
<div class="highlight-python"><div class="highlight"><pre>outputs:
  instance_ip:
    description: IP address of the deployed compute instance
    value: { get_attr: [my_instance, first_address] }
</pre></div>
</div>
</div>
<div class="section" id="intrinsic-functions">
<span id="hot-spec-intrinsic-functions"></span><h2>Intrinsic Functions<a class="headerlink" href="#intrinsic-functions" title="Permalink to this headline">¶</a></h2>
<p>HOT provides a set of intrinsic functions that can be used inside HOT templates
to perform specific tasks, such as getting the value of a resource attribute at
runtime. A definition of all intrinsic functions available in HOT is given
below.</p>
<div class="section" id="get-attr">
<h3>get_attr<a class="headerlink" href="#get-attr" title="Permalink to this headline">¶</a></h3>
<p>The <em>get_attr</em> function allows referencing an attribute of a resource. At
runtime, it will be resolved to the value of an attribute of a resource instance
created from the respective resource definition of the template.
The syntax of the get_attr function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>get_attr:
  - &lt;resource name&gt;
  - &lt;attribute name&gt;
  - &lt;key/index 1&gt; (optional)
  - &lt;key/index 2&gt; (optional)
  - ...
</pre></div>
</div>
<dl class="docutils">
<dt>resource name</dt>
<dd>This parameter specifies the resource for which the attributes shall be
resolved. This resource must be defined within the <em>resources</em> section of
the template (see also <a class="reference internal" href="#hot-spec-resources"><em>Resources Section</em></a>).</dd>
<dt>attribute name</dt>
<dd>The attribute name is required as it specifies the attribute
to be resolved. If the attribute returns a complex data structure
such as a list or a map, then subsequent keys or indexes can be specified
which navigate the data structure to return the desired value.</dd>
</dl>
<p>Some examples of how to use the get_attr function are shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  my_instance:
    type: OS::Nova::Server
    # ...

outputs:
  instance_ip:
    description: IP address of the deployed compute instance
    value: { get_attr: [my_instance, first_address] }
  instance_private_ip:
    description: Private IP address of the deployed compute instance
    value: { get_attr: [my_instance, networks, private, 0] }
</pre></div>
</div>
<p>In this example, if the networks attribute contained the following data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;public&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;2001:0db8:0000:0000:0000:ff00:0042:8329&quot;</span><span class="p">,</span> <span class="s">&quot;1.2.3.4&quot;</span><span class="p">],</span>
 <span class="s">&quot;private&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;10.0.0.1&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>then the value of the get_attr function would resolve to &#8220;10.0.0.1&#8221;.</p>
</div>
<div class="section" id="get-file">
<h3>get_file<a class="headerlink" href="#get-file" title="Permalink to this headline">¶</a></h3>
<p>The <em>get_file</em> function allows string content to be substituted into the
template. It is generally used as a file inclusion mechanism for files
containing non-heat scripts or configuration files.
The syntax of the get_file function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>get_file: &lt;content key&gt;
</pre></div>
</div>
<p>The <em>content key</em> will be used to look up the files dictionary that is
provided in the REST API call. The <em>heat</em> client command from
python-heatclient is <em>get_file</em> aware and will populate the <em>files</em> with
the actual content of fetched paths and URLs. The <em>heat</em> client command
supports relative paths and will transform these to absolute URLs which
will be used as the <em>content key</em> in the files dictionary.</p>
<p>Note: The argument to <em>get_file</em> should be a static path or URL and not
rely on intrinsic functions like <em>get_param</em>. In general, the <em>heat</em> client
does not process intrinsic functions (they are only processed by the heat
server).</p>
<p>The example below demonstrates <em>get_file</em> usage with both relative and
absolute URLs.</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      # general properties ...
      user_data:
        get_file: my_instance_user_data.sh
  my_other_instance:
    type: OS::Nova::Server
    properties:
      # general properties ...
      user_data:
        get_file: http://example.com/my_other_instance_user_data.sh
</pre></div>
</div>
<p>If this template was launched from a local file this would result in
a <em>files</em> dictionary containing entries with keys
<em>file:///path/to/my_instance_user_data.sh</em> and
<em>http://example.com/my_other_instance_user_data.sh</em>.</p>
</div>
<div class="section" id="get-param">
<h3>get_param<a class="headerlink" href="#get-param" title="Permalink to this headline">¶</a></h3>
<p>The <em>get_param</em> function allows for referencing an input parameter of a template
from anywhere within a template. At runtime, it will be resolved to the value
provided for this input parameter. The syntax of the <em>get_param</em> function is as
follows:</p>
<div class="highlight-python"><div class="highlight"><pre>get_param:
  - &lt;parameter name&gt;
  - &lt;key/index 1&gt; (optional)
  - &lt;key/index 2&gt; (optional)
  - ...
</pre></div>
</div>
<dl class="docutils">
<dt>parameter name</dt>
<dd>The parameter name is required as it specifies the parameter
to be resolved. If the parameter returns a complex data structure
such as a list or a map, then subsequent keys or indexes can be specified
which navigate the data structure to return the desired value.</dd>
</dl>
<p>A sample use of this function in context of a resource definition
is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  instance_type:
    type: string
    label: Instance Type
    description: Instance type to be used.
  server_data:
    type: json

resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      flavor: { get_param: instance_type}
      metadata: { get_param: [ server_data, metadata ] }
      key_name: { get_param: [ server_data, keys, 0 ] }
</pre></div>
</div>
<p>In this example, if the instance_type/server_data parameters contained
the following data:</p>
<div class="highlight-python"><div class="highlight"><pre>{&quot;instance_type&quot;: &quot;m1.tiny&quot;,
{&quot;server_data&quot;: {&quot;metadata&quot;: {&quot;foo&quot;: &quot;bar&quot;},
                 &quot;keys&quot;: [&quot;a_key&quot;,&quot;other_key&quot;]}}}
</pre></div>
</div>
<p>then the value of the property &#8216;flavor&#8217; would resolve to &#8220;m1.tiny&#8221;, &#8216;metadata&#8217;
would resolve to {&#8220;foo&#8221;: &#8220;bar&#8221;} and &#8216;key_name&#8217; would resolve to &#8220;a_key&#8221;.</p>
</div>
<div class="section" id="get-resource">
<h3>get_resource<a class="headerlink" href="#get-resource" title="Permalink to this headline">¶</a></h3>
<p>The <em>get_resource</em> function allows for referencing another resource within the
same template. At runtime, it will be resolved to reference ID of the resource,
which is resource type specific. For example, a reference to a floating IP
resource will return the respective IP address at runtime.
The syntax of the get_resource function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>get_resource: &lt;resource ID&gt;
</pre></div>
</div>
<p>The <em>resource ID</em> of the referenced resources as used in the current template is
given as single parameter to the get_resource function.</p>
</div>
<div class="section" id="list-join">
<h3>list_join<a class="headerlink" href="#list-join" title="Permalink to this headline">¶</a></h3>
<p>The <em>list_join</em> function joins a list of strings with the given delimiter. This
function is introduced in the Juno release, usable in HOT versions later than
<cite>2013-05-23</cite>.  The syntax of the list_join function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>list_join:
- &lt;delimiter&gt;
- &lt;list to join&gt;
</pre></div>
</div>
<p>A sample use of this function with a simple list is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre>list_join: [&#39;, &#39;, [&#39;one&#39;, &#39;two&#39;, &#39;and three&#39;]]
</pre></div>
</div>
<p>This would resolve to &#8220;one, two, and three&#8221;.</p>
</div>
<div class="section" id="digest">
<h3>digest<a class="headerlink" href="#digest" title="Permalink to this headline">¶</a></h3>
<p>The <em>digest</em> function allows for performing digest operations on a given value.
This function has been introduced in the Kilo release and is usable with HOT versions
later than <cite>2015-04-30</cite>.</p>
<p>The syntax of the digest function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>digest:
  - &lt;algorithm&gt;
  - &lt;value&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>algorithm</dt>
<dd>The digest algorithm. Valid algorithms are the ones
provided natively by hashlib (md5, sha1, sha224, sha256, sha384,
and sha512) or any one provided by OpenSSL.</dd>
<dt>value</dt>
<dd>The value to digest. This function will resolve to the corresponding hash of
the value.</dd>
</dl>
<p>An example of how to use the digest function is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre># from a user supplied parameter
pwd_hash: { digest: [&#39;sha512&#39;, { get_param: raw_password }] }
</pre></div>
</div>
<p>The value of the digest function would resolve to the corresponding hash of
the value of &#8216;raw_password&#8217;.</p>
</div>
<div class="section" id="repeat">
<h3>repeat<a class="headerlink" href="#repeat" title="Permalink to this headline">¶</a></h3>
<p>The <em>repeat</em> function allows for dynamically transforming lists by iterating
over the contents of one or more source lists and replacing the list elements
into a template. The result of this function is a new list, where the elements
are set to the template, rendered for each list item.</p>
<p>The syntax of the repeat function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>repeat:
  template:
    &lt;template&gt;
  for_each:
    &lt;var&gt;: &lt;list&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>template</dt>
<dd>The <em>template</em> argument defines the content generated for each iteration,
with placeholders for the elements that need to be replaced at runtime.
This argument can be of any supported type.</dd>
<dt>for_each</dt>
<dd>The <em>for_each</em> argument is a dictionary that defines how to generate the
repetitions of the template and perform substitutions. In this dictionary
the keys are the placeholder names that will be replaced in the template,
and the values are the lists to iterate on. On each iteration, the function
will render the template by performing substitution with elements of the
given lists. If a single key/value pair is given in this argument, the
template will be rendered once for each element in the list. When more
than one key/value pairs are given, the iterations will be performed on all
the permutations of values between the given lists. The values in this
dictionary can be given as functions such as get_attr or get_param.</dd>
</dl>
<p>The example below shows how a security group resource can be defined to
include a list of ports given as a parameter.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  ports:
    type: comma_delimited_list
    label: ports
    default: &quot;80,443,8080&quot;

resources:
  security_group:
    type: OS::Neutron::SecurityGroup
    properties:
      name: web_server_security_group
      rules:
        repeat:
          for_each:
            %port%: { get_param: ports }
          template:
            protocol: tcp
            port_range_min: %port%
            port_range_max: %port%
</pre></div>
</div>
<p>The next example demonstrates how the use of multiple lists enables the
security group to also include parameterized protocols.</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  ports:
    type: comma_delimited_list
    label: ports
    default: &quot;80,443,8080&quot;
  protocols:
    type: comma_delimited_list
    label: protocols
    default: &quot;tcp,udp&quot;

resources:
  security_group:
    type: OS::Neutron::SecurityGroup
    properties:
      name: web_server_security_group
      rules:
        repeat:
          for_each:
            %port%: { get_param: ports }
            %protocol%: { get_param: protocols }
          template:
            protocol: %protocol%
            port_range_min: %port%
</pre></div>
</div>
<p>Note how multiple entries in the <tt class="docutils literal"><span class="pre">for_each</span></tt> argument are equivalent to
nested for-loops in most programming languages.</p>
</div>
<div class="section" id="resource-facade">
<h3>resource_facade<a class="headerlink" href="#resource-facade" title="Permalink to this headline">¶</a></h3>
<p>The <em>resource_facade</em> function allows a provider template to retrieve data
about its resource facade in the parent template. A provider template is used
to provide a custom definition of a resource - the facade - in the form of a
Heat template. The resource&#8217;s properties are passed to the provider template as
its parameters, but other resource data can be included using this function.)</p>
<p>The syntax of the <em>resource_facade</em> function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>resource_facade: &lt;data type&gt;
</pre></div>
</div>
<p>The <em>data type</em> can be <cite>metadata</cite>, <cite>deletion_policy</cite> or <cite>update_policy</cite>.</p>
</div>
<div class="section" id="str-replace">
<h3>str_replace<a class="headerlink" href="#str-replace" title="Permalink to this headline">¶</a></h3>
<p>The <em>str_replace</em> function allows for dynamically constructing strings by
providing a template string with placeholders and a list of mappings to assign
values to those placeholders at runtime. The placeholders are replaced with
mapping values wherever a mapping key exactly matches a placeholder.
The syntax of the str_replace function is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>str_replace:
  template: &lt;template string&gt;
  params: &lt;parameter mappings&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>template</dt>
<dd>The <em>template</em> argument defines the template string that contains
placeholders which will be substituted at runtime.</dd>
<dt>params</dt>
<dd>The <em>params</em> argument provides parameter mappings in the form of a
dictionary, which will be used for placeholder substitution in the template
string at runtime. Within parameter mappings one can make use of other
functions (e.g. get_attr to use resource attribute values) for template
substitution.</dd>
</dl>
<p>The example below shows a simple use of the str_replace function in the outputs
section of a template to build a URL for logging into a deployed application.</p>
<div class="highlight-python"><div class="highlight"><pre>resources:
  my_instance:
    type: OS::Nova::Server
    # general metadata and properties ...

outputs:
  Login_URL:
    description: The URL to log into the deployed application
    value:
      str_replace:
        template: http://host/MyApplication
        params:
          host: { get_attr: [ my_instance, first_address ] }
</pre></div>
</div>
<p>The str_replace function can also be used for constructing bigger chunks of text
like scripts for initializing compute instances as shown in the example below:</p>
<div class="highlight-python"><div class="highlight"><pre>parameters:
  DBRootPassword:
    type: string
    label: Database Password
    description: Root password for MySQL
    hidden: true

resources:
  my_instance:
    type: OS::Nova::Server
    properties:
      # general properties ...
      user_data:
        str_replace:
          template: |
            #!/bin/bash
            echo &quot;Hello world&quot;
            echo &quot;Setting MySQL root password&quot;
            mysqladmin -u root password $db_rootpassword
            # do more things ...
          params:
            $db_rootpassword: { get_param: DBRootPassword }
</pre></div>
</div>
<p>In the example above, one can imagine that MySQL is being configured on a
compute instance and the root password is going to be set based on a user
provided parameter. The script for doing this is provided as userdata to the
compute instance, leveraging the str_replace function.</p>
</div>
<div class="section" id="fn-select">
<h3>Fn::Select<a class="headerlink" href="#fn-select" title="Permalink to this headline">¶</a></h3>
<p><em>Fn::Select</em> is a function borrowed from CFN template.  Please check the CFN
template guide for a description.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../raxdox/index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Heat Orchestration Template (HOT) Specification</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#template-structure">Template Structure</a></li>
<li><a class="reference internal" href="#heat-template-version">Heat Template Version</a></li>
<li><a class="reference internal" href="#parameter-groups-section">Parameter Groups Section</a></li>
<li><a class="reference internal" href="#parameters-section">Parameters Section</a><ul>
<li><a class="reference internal" href="#parameter-constraints">Parameter Constraints</a><ul>
<li><a class="reference internal" href="#length">length</a></li>
<li><a class="reference internal" href="#range">range</a></li>
<li><a class="reference internal" href="#allowed-values">allowed_values</a></li>
<li><a class="reference internal" href="#allowed-pattern">allowed_pattern</a></li>
<li><a class="reference internal" href="#custom-constraint">custom_constraint</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pseudo-parameters">Pseudo Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resources-section">Resources Section</a><ul>
<li><a class="reference internal" href="#resource-dependencies">Resource Dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#outputs-section">Outputs Section</a></li>
<li><a class="reference internal" href="#intrinsic-functions">Intrinsic Functions</a><ul>
<li><a class="reference internal" href="#get-attr">get_attr</a></li>
<li><a class="reference internal" href="#get-file">get_file</a></li>
<li><a class="reference internal" href="#get-param">get_param</a></li>
<li><a class="reference internal" href="#get-resource">get_resource</a></li>
<li><a class="reference internal" href="#list-join">list_join</a></li>
<li><a class="reference internal" href="#digest">digest</a></li>
<li><a class="reference internal" href="#repeat">repeat</a></li>
<li><a class="reference internal" href="#resource-facade">resource_facade</a></li>
<li><a class="reference internal" href="#str-replace">str_replace</a></li>
<li><a class="reference internal" href="#fn-select">Fn::Select</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/template_guide/hot_spec.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../raxdox/index.html">Supported Resources</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012,2015 Rackspace.
      Last updated on Mon Apr 13 21:08:05 2015, commit 58cb011.
    </div>
  </body>
</html>