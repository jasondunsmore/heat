<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Building JEOS images for use with Heat &mdash; Supported Resources</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2015.2.0.dev378',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Supported Resources" href="../raxdox/index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../raxdox/index.html">Supported Resources</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-jeos-images-for-use-with-heat">
<h1>Building JEOS images for use with Heat<a class="headerlink" href="#building-jeos-images-for-use-with-heat" title="Permalink to this headline">¶</a></h1>
<p>Heat&#8217;s full functionality can only be used when launching cloud images that have
the <a class="reference external" href="https://github.com/openstack/heat-cfntools">heat-cfntools</a> package installed.
This document describes some options for creating a heat-cfntools enabled image
for yourself.</p>
<div class="section" id="building-an-image-with-diskimage-builder">
<h2>Building an image with diskimage-builder<a class="headerlink" href="#building-an-image-with-diskimage-builder" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/openstack/diskimage-builder">diskimage-builder</a> is a tool for customizing cloud images.
<a class="reference external" href="https://github.com/openstack/tripleo-image-elements">tripleo-image-elements</a> is a collection of diskimage-builder elements related
to the <a class="reference external" href="https://wiki.openstack.org/wiki/TripleO">TripleO</a> project. It includes an element for heat-cfntools which can be
used to create heat-enabled images.</p>
<p>Install the tool (preferably in a virtualenv) and fetch the elements:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install git+https://github.com/openstack/diskimage-builder.git
git clone https://github.com/openstack/tripleo-image-elements.git
</pre></div>
</div>
<p>To create a heat-cfntools enabled image with the current release of Fedora x86_64:</p>
<div class="highlight-python"><div class="highlight"><pre>export ELEMENTS_PATH=tripleo-image-elements/elements
disk-image-create vm fedora heat-cfntools -a amd64 -o fedora-heat-cfntools
</pre></div>
</div>
<p>The image may then be pushed to glance, e.g:</p>
<div class="highlight-python"><div class="highlight"><pre>source ~/.openstack/keystonerc
glance image-create --name fedora-heat-cfntools --is-public true --disk-format qcow2 --container-format bare &lt; fedora-heat-cfntools.qcow2
</pre></div>
</div>
<p>To create a heat-cfntools enabled image with the current release of Ubuntu i386:</p>
<div class="highlight-python"><div class="highlight"><pre>export ELEMENTS_PATH=tripleo-image-elements/elements
disk-image-create vm ubuntu heat-cfntools -a i386 -o ubuntu-heat-cfntools
</pre></div>
</div>
<p>If you are creating your own images you should consider creating golden images
which contain all the packages required for the stacks that you launch. You can do
this by writing your own diskimage-builder elements and invoking those elements
in the call to disk-image-create.</p>
<p>This means that the resulting heat templates only need to modify configuration
files. This will speed stack launch time and reduce the risk of a transient
package download failure causing the stack launch to fail.</p>
<p>To create an image that contains hooks needed for SoftwareConfig and SoftwareDeployment,
you can follow the steps bellow to build a fedora based image:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install git+https://git.openstack.org/openstack/diskimage-builder.git
git clone https://git.openstack.org/openstack/tripleo-image-elements.git
git clone https://git.openstack.org/openstack/heat-templates.git
export ELEMENTS_PATH=tripleo-image-elements/elements:heat-templates/hot/software-config/elements
disk-image-create vm \
    fedora selinux-permissive \
    heat-config \
    os-collect-config \
    os-refresh-config \
    os-apply-config \
    heat-config-cfn-init \
    heat-config-puppet \
    heat-config-script \
    -o fedora-software-config.qcow2
</pre></div>
</div>
<p>The image may then be pushed to glance, e.g:</p>
<div class="highlight-python"><div class="highlight"><pre>source ~/.openstack/keystonerc
glance image-create --name=fedora-software-config --is-public=true --disk-format=qcow2 --container-format=bare &lt; fedora-software-config.qcow2
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../raxdox/index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Building JEOS images for use with Heat</a><ul>
<li><a class="reference internal" href="#building-an-image-with-diskimage-builder">Building an image with diskimage-builder</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/getting_started/jeos_building.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../raxdox/index.html">Supported Resources</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012,2015 Heat Developers.
      Last updated on Wed May 20 12:03:06 2015, commit 58910c6.
    </div>
  </body>
</html>